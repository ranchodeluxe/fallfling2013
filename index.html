<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>A HowTo About A HowTo: The Python GDAL/OGR Cookbook by thebigspoon</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1 class="header">A HowTo About A HowTo: The Python GDAL/OGR Cookbook</h1>
        <p class="header">CUGOS 2013 Fall Fling Smackdown</p>

        <ul>
          <li class="download"><a class="buttons" href="https://github.com/thebigspoon/fallfling2013/zipball/master">Download ZIP</a></li>
          <li class="download"><a class="buttons" href="https://github.com/thebigspoon/fallfling2013/tarball/master">Download TAR</a></li>
          <li><a class="buttons github" href="https://github.com/thebigspoon/fallfling2013">View On GitHub</a></li>
        </ul>

        <p class="header">This project is maintained by <a class="header name" href="https://github.com/thebigspoon">thebigspoon</a></p>


      </header>
      <section>
        <h1>
<a name="welcome-to-the-smackdown" class="anchor" href="#welcome-to-the-smackdown"><span class="octicon octicon-link"></span></a>Welcome to the Smackdown!</h1>

<p>Let's learn how we can use 
<a href="http://pcjericks.github.io/py-gdalogr-cookbook/">Pierce County's awesome Python GDAL/OGR Cookbook</a>. 
But first, let's install a bunch of junk on your computer if it's not already there.</p>

<h2>
<a name="tooling-installs-data" class="anchor" href="#tooling-installs-data"><span class="octicon octicon-link"></span></a>Tooling, Installs, Data</h2>

<p>Some tools we'll use today to explore the cookbook include:</p>

<ol>
<li>
<strong>Shell</strong>  # Windows users have CMD, PowerShell or GitBash ( see below ). Terminal for Mac</li>
<li><strong>Python</strong></li>
<li><strong>GDAL/OGR Library and Python Bindings</strong></li>
<li>
<a href="http://mapfart.com">Mapfart.com</a> or <strong>QGIS</strong>  # to visualize the input/outputs</li>
<li>
<strong>Shapefiles</strong>  # i got mine from <a href="http://www5.kingcounty.gov/gisdataportal/Default.aspx">King County GIS Portal</a>
</li>
<li>
<strong>PostGIS</strong>  # if you care about database support</li>
</ol><p>We will <strong>not</strong> be walking people through installs. Installs depend on the 
operating system you are running among other factors. So here's a list of places 
to get started depending on your operating system:</p>

<hr><h4>
<a name="windows" class="anchor" href="#windows"><span class="octicon octicon-link"></span></a>Windows</h4>

<p>There's no particular reason to use 
<a href="http://code.google.com/p/msysgit/downloads/list?q=label:Featured">GitBash</a> 
for these examples. Using CMD or PowerShell in Windows is fine. 
Most of the time we will just be running <code>python &lt;script_name&gt;</code> commands. 
But sometimes we might be running shell commands that look unfamiliar. 
If you want to explore a Linux-type shell environment 
then <a href="http://code.google.com/p/msysgit/downloads/list?q=label:Featured">GitBash</a> 
is a good place to start.</p>

<p>Luckily Python, GDAL/OGR ( w/ Python bindings ) and QGIS can all be installed 
in one shot with <a href="http://trac.osgeo.org/osgeo4w/wiki">OSGeo4W</a>.</p>

<p>PostGIS can be installed as a plugin after you install the <a href="http://www.postgresql.org/download/windows/">Postgresql database
with this sweet GUI installer</a>.</p>

<hr><h4>
<a name="mac" class="anchor" href="#mac"><span class="octicon octicon-link"></span></a>Mac</h4>

<p>Specific GDAL install instructions can be found 
<a href="http://www.kyngchaos.com/software:frameworks">here</a>. 
That tutorial references 
<a href="http://www.kyngchaos.com/software:frameworks">this repository</a> 
where you can find QGIS and PostGIS among a number of other GIS installs for Mac.</p>

<hr><h4>
<a name="linux--debian-and-ubuntu-" class="anchor" href="#linux--debian-and-ubuntu-"><span class="octicon octicon-link"></span></a>Linux ( Debian and Ubuntu )</h4>

<p>If you are into using packages then you probably want to use 
the <a href="https://wiki.ubuntu.com/UbuntuGIS">UbuntuGIS PPA</a>.</p>

<p>If you like to run <code>config, make, make install</code> stuff then:</p>

<div class="highlight highlight-bash"><pre><span class="c">#</span>
<span class="c"># get subversion, git</span>
<span class="c">#</span>
<span class="nv">$ </span>sudo apt-get install subversion git

<span class="c">#</span>
<span class="c"># get gcc components and build tools</span>
<span class="c">#</span>
<span class="nv">$ </span>sudo apt-get install build-essential libtool automake binutils

<span class="c">#</span>
<span class="c"># python tools</span>
<span class="c">#</span>
<span class="nv">$ </span>sudo apt-get install python-setuptools python-dev python-psycopg2 python-virtualenv


<span class="c">#</span>
<span class="c">#  PROJ4</span>
<span class="c">#</span>
mkdir -p /usr/local/src/proj
<span class="nb">cd</span> /usr/local/src/proj
wget http://download.osgeo.org/proj/proj-4.7.0.tar.gz <span class="c"># or the one you want</span>
tar -xzvf proj-4.7.0.tar.gz
<span class="nb">cd </span>proj-4.7.0/nad
wget http://download.osgeo.org/proj/proj-datumgrid-1.5.zip
sudo apt-get install zip
unzip proj-datumgrid-1.5.zip
rm proj-datumgrid-1.5.zip
<span class="nb">cd</span> ..
./configure
make
sudo make install
sudo ldconfig

<span class="c"># you'll probably need to define some more projections</span>
vim /usr/local/share/proj/epsg
<span class="c"># add the following projections to the end of the file</span>
<span class="c"># google spherical mercator</span>
&lt;900913&gt; +proj<span class="o">=</span>merc +a<span class="o">=</span>6378137 +b<span class="o">=</span>6378137 +lat_ts<span class="o">=</span>0.0 +lon_0<span class="o">=</span>0.0 +x_0<span class="o">=</span>0.0 +y_0<span class="o">=</span>0 +k<span class="o">=</span>1.0 +units<span class="o">=</span>m +nadgrids<span class="o">=</span>@null +wktext  +no_defs  &lt;&gt;
<span class="c"># custom esri projection from http://spatialreference.org/ref/esri/102761/</span>
&lt;9102761&gt; +proj<span class="o">=</span>lcc +lat_1<span class="o">=</span>18.03333333333334 +lat_2<span class="o">=</span>18.43333333333333 +lat_0<span class="o">=</span>17.83333333333333 +lon_0<span class="o">=</span>-66.43333333333334 +x_0<span class="o">=</span>200000 +y_0<span class="o">=</span>200000 +ellps<span class="o">=</span>GRS80 +datum<span class="o">=</span>NAD83 +to_meter<span class="o">=</span>0.3048006096012192 +no_defs  &lt;&gt;

<span class="c">#</span>
<span class="c">#  GEOS</span>
<span class="c">#</span>
mkdir -p /usr/local/src/geos
<span class="nb">cd</span> /usr/local/src/geos
wget http://download.osgeo.org/geos/geos-3.3.1.tar.bz2 <span class="c"># or the one you want</span>
tar -xjvf geos-3.3.1.tar.bz2
<span class="nb">cd </span>geos-3.3.1
./configure
make
sudo make install
sudo ldconfig


<span class="c">#</span>
<span class="c">#  GDAL/OGR</span>
<span class="c">#</span>
mkdir -p /usr/local/src/gdal
<span class="nb">cd</span> /usr/local/src/gdal
<span class="c"># Release</span>
wget http://download.osgeo.org/gdal/gdal-1.8.1.tar.gz <span class="c"># or the one you want</span>
tar -xzvf gdal-*.tar.gz
rm gdal-*.tar.gz
<span class="nb">cd </span>gdal-*
./configure --with-python --with-threads --with-pg --with-geos<span class="o">=</span>yes
make
sudo make install
sudo ldconfig
</pre></div>

<hr><h2>
<a name="cookbook-handling-techniques" class="anchor" href="#cookbook-handling-techniques"><span class="octicon octicon-link"></span></a>Cookbook Handling Techniques</h2>

<p>Now that everything is installed, let's see how easy it is to use the 
cookbook examples.</p>

<h3>
<a name="python-shell--exploratory-hack-" class="anchor" href="#python-shell--exploratory-hack-"><span class="octicon octicon-link"></span></a>Python Shell ( Exploratory Hack )</h3>

<p>If you are not familiar with Python, then running the Python shell might be new. 
The Python shell is an interactive way to explore the code you write while 
writing it. We can learn
a lot about the OGR bindings by writing our examples line-by-line in the shell:</p>

<ol>
<li><p>Navigate to the <a href="http://pcjericks.github.io/py-gdalogr-cookbook/geometry.html">start of the cookbook</a>
and choose a simple example such
as the one about 
<a href="http://pcjericks.github.io/py-gdalogr-cookbook/geometry.html#create-geometry-from-wkt">creating a geometry object from WKT</a>.</p></li>
<li>
<p>Go to your shell and type <code>python</code> so it boots into the Python shell ( you should see something similar below ):</p>

<div class="highlight highlight-python"><pre><span class="n">Python</span> <span class="mf">2.7</span><span class="o">.</span><span class="mi">3</span> <span class="p">(</span><span class="n">default</span><span class="p">,</span> <span class="n">Aug</span>  <span class="mi">1</span> <span class="mi">2012</span><span class="p">,</span> <span class="mo">05</span><span class="p">:</span><span class="mi">14</span><span class="p">:</span><span class="mi">39</span><span class="p">)</span> 
<span class="p">[</span><span class="n">GCC</span> <span class="mf">4.6</span><span class="o">.</span><span class="mi">3</span><span class="p">]</span> <span class="n">on</span> <span class="n">linux2</span>
<span class="n">Type</span> <span class="s">"help"</span><span class="p">,</span> <span class="s">"copyright"</span><span class="p">,</span> <span class="s">"credits"</span> <span class="ow">or</span> <span class="s">"license"</span> <span class="k">for</span> <span class="n">more</span> <span class="n">information</span><span class="o">.</span>
<span class="o">&gt;&gt;&gt;</span>
</pre></div>
</li>
<li><p>Start copying the example line-by-line and hit return at the end of each line.
You can also copy and paste the whole example, but writing it out might
help you remember it better</p></li>
<li>
<p>You can explore each OGR object using help() command:</p>

<div class="highlight highlight-python"><pre><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">osgeo</span> <span class="kn">import</span> <span class="n">ogr</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">wkt</span> <span class="o">=</span> <span class="s">"POINT (1120351.5712494177 741921.4223245403)"</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">point</span> <span class="o">=</span> <span class="n">ogr</span><span class="o">.</span><span class="n">CreateGeometryFromWkt</span><span class="p">(</span><span class="n">wkt</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">type</span><span class="p">(</span> <span class="n">point</span>  <span class="p">)</span>
<span class="o">&lt;</span><span class="k">class</span> <span class="err">'</span><span class="nc">osgeo</span><span class="o">.</span><span class="n">ogr</span><span class="o">.</span><span class="n">Geometry</span><span class="s">'&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">help</span><span class="p">(</span> <span class="n">point</span> <span class="p">)</span>

<span class="n">Help</span> <span class="n">on</span> <span class="n">Geometry</span> <span class="ow">in</span> <span class="n">module</span> <span class="n">osgeo</span><span class="o">.</span><span class="n">ogr</span> <span class="nb">object</span><span class="p">:</span>

<span class="k">class</span> <span class="nc">Geometry</span><span class="p">(</span><span class="n">__builtin__</span><span class="o">.</span><span class="n">object</span><span class="p">)</span>
 <span class="o">|</span>  <span class="n">Proxy</span> <span class="n">of</span> <span class="n">C</span><span class="o">++</span> <span class="n">OGRGeometryShadow</span> <span class="k">class</span>
 <span class="err">|  </span>
 <span class="o">|</span>  <span class="n">Methods</span> <span class="n">defined</span> <span class="n">here</span><span class="p">:</span>
 <span class="o">|</span>  
 <span class="o">|</span>  <span class="n">AddGeometry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
 <span class="o">|</span>      <span class="n">AddGeometry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Geometry</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">OGRErr</span>
 <span class="o">|</span>  
 <span class="o">|</span>  <span class="n">AddGeometryDirectly</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
 <span class="o">|</span>      <span class="n">AddGeometryDirectly</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Geometry</span> <span class="n">other_disown</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">OGRErr</span>
 <span class="o">|</span>  
 <span class="o">|</span>  <span class="n">AddPoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
 <span class="o">|</span>      <span class="n">AddPoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">double</span> <span class="n">x</span><span class="p">,</span> <span class="n">double</span> <span class="n">y</span><span class="p">,</span> <span class="n">double</span> <span class="n">z</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
 <span class="o">|</span>  
 <span class="o">|</span>  <span class="n">AddPoint_2D</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
 <span class="o">|</span>      <span class="n">AddPoint_2D</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">double</span> <span class="n">x</span><span class="p">,</span> <span class="n">double</span> <span class="n">y</span><span class="p">)</span>
 <span class="o">|</span>  
 <span class="o">|</span>  <span class="n">AssignSpatialReference</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
 <span class="o">|</span>      <span class="n">AssignSpatialReference</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">SpatialReference</span> <span class="n">reference</span><span class="p">)</span>
 <span class="o">|</span>    

 <span class="o">...</span><span class="n">output</span> <span class="n">truncated</span><span class="o">...</span>
</pre></div>
</li>
<li>
<p>I see there's an AddPoint method on my geometry object. Let's see what we break:</p>

<div class="highlight highlight-python"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">point</span><span class="o">.</span><span class="n">AddPoint</span><span class="p">(</span> <span class="o">-</span><span class="mi">9999</span><span class="p">,</span> <span class="mi">99999</span> <span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">point</span><span class="o">.</span><span class="n">ExportToWkt</span><span class="p">()</span>
<span class="s">'POINT (-9999 99999 0)'</span>
<span class="c">#</span>
<span class="c"># Looks like that overrides our initial geometry. That's not good!</span>
<span class="c">#</span>
</pre></div>
</li>
</ol><h3>
<a name="python-scripts--one-offs-" class="anchor" href="#python-scripts--one-offs-"><span class="octicon octicon-link"></span></a>Python Scripts ( One Offs )</h3>

<p>We can also take the examples from the cookbook and run them as Python scripts.
This is assuming you didn't want to pass in any dynamic arguments.</p>

<ol>
<li><p>Let's copy 
<a href="http://pcjericks.github.io/py-gdalogr-cookbook/geometry.html#count-geometries-in-a-geometry">this count geometries example</a>
into a python file called <code>count.py</code></p></li>
<li>
<p>Then in the shell navigate to the directory where your <code>count.py</code> file exists and run:</p>

<div class="highlight highlight-bash"><pre><span class="nv">$ </span>python count.py
</pre></div>
</li>
<li>
<p>The code will run and should output content to the shell window like this:</p>

<div class="highlight highlight-bash"><pre>0<span class="o">)</span>. POINT <span class="o">(</span>1181866 615654<span class="o">)</span>
1<span class="o">)</span>. POINT <span class="o">(</span>1205917 623979<span class="o">)</span>
2<span class="o">)</span>. POINT <span class="o">(</span>1227192 643405<span class="o">)</span>
3<span class="o">)</span>. POINT <span class="o">(</span>1224880 665143<span class="o">)</span>

</pre></div>
</li>
</ol><h3>
<a name="python-scripts--add-args-" class="anchor" href="#python-scripts--add-args-"><span class="octicon octicon-link"></span></a>Python Scripts ( Add Args )</h3>

<p>Let's write a script similar to the example above, but now let's add in ability for passing
dynamic args as an example. I took the buffer example <a href="http://pcjericks.github.io/py-gdalogr-cookbook/geometry.html#buffer-a-geometry">here</a> 
and modified.</p>

<ol>
<li>
<p>Copy the following code into a file called <code>buffer.py</code>:</p>

<div class="highlight highlight-python"><pre><span class="kn">from</span> <span class="nn">osgeo</span> <span class="kn">import</span> <span class="n">ogr</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>

    <span class="c"># make sure user passes buffer value</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span> <span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span> <span class="s">'[ ERROR ]: you must pass a buffer value'</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span> <span class="mi">1</span> <span class="p">)</span>

    <span class="n">bufferDistance</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span>
    <span class="n">wkt</span> <span class="o">=</span> <span class="s">"POINT (1198054.34 648493.09)"</span>
    <span class="n">pt</span> <span class="o">=</span> <span class="n">ogr</span><span class="o">.</span><span class="n">CreateGeometryFromWkt</span><span class="p">(</span><span class="n">wkt</span><span class="p">)</span>
    <span class="n">poly</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">Buffer</span><span class="p">(</span><span class="n">bufferDistance</span><span class="p">)</span>
    <span class="k">print</span> <span class="s">"</span><span class="si">%s</span><span class="s"> buffered by </span><span class="si">%d</span><span class="s"> is </span><span class="si">%s</span><span class="s">"</span> <span class="o">%</span> <span class="p">(</span><span class="n">pt</span><span class="o">.</span><span class="n">ExportToWkt</span><span class="p">(),</span> <span class="n">bufferDistance</span><span class="p">,</span> <span class="n">poly</span><span class="o">.</span><span class="n">ExportToWkt</span><span class="p">())</span>

</pre></div>
</li>
<li>
<p>Now when we run it we pass a buffer value. If we don't pass anything, it throws an error:</p>

<div class="highlight highlight-bash"><pre><span class="nv">$ </span>python test.py
<span class="o">[</span> ERROR <span class="o">]</span>: you must pass a buffer value
<span class="nv">$ </span>python test.py 2
POINT <span class="o">(</span>1198054.340000000083819 648493.089999999967404<span class="o">)</span> buffered by 2 is POLYGON <span class="o">((</span>1198056.340000000083819 648493.089999999967404,1198056.337259069550782 648492.985328087466769,1198056.329043790930882 648492.880943073425442,1198056....
<span class="c"># ... output truncated cause it's long dude</span>

</pre></div>
</li>
</ol><hr><h2>
<a name="ogr-datasources-layers----oh-my" class="anchor" href="#ogr-datasources-layers----oh-my"><span class="octicon octicon-link"></span></a>OGR, DataSources, Layers -- Oh My!</h2>

<p>The official <a href="http://gdal.org/python/">Python GDAL/OGR</a> binding documentation goes
into all necessary technical detail about the API for each class. It's a good place
to start. He's a roundup of some </p>

<h3>
<a name="ogr-namespaced-functions" class="anchor" href="#ogr-namespaced-functions"><span class="octicon octicon-link"></span></a>OGR Namespaced Functions</h3>

<h3>
<a name="datasources" class="anchor" href="#datasources"><span class="octicon octicon-link"></span></a>DataSources</h3>

<h3>
<a name="layers" class="anchor" href="#layers"><span class="octicon octicon-link"></span></a>Layers</h3>

<h3>
<a name="features-geometry-fields" class="anchor" href="#features-geometry-fields"><span class="octicon octicon-link"></span></a>Features, Geometry Fields</h3>

<h3>
<a name="projections" class="anchor" href="#projections"><span class="octicon octicon-link"></span></a>Projections</h3>

<hr><h2>
<a name="show-me-something-cool" class="anchor" href="#show-me-something-cool"><span class="octicon octicon-link"></span></a>Show Me Something Cool</h2>

<hr><h2>
<a name="tricks-trapdoors-gotchas" class="anchor" href="#tricks-trapdoors-gotchas"><span class="octicon octicon-link"></span></a>Tricks, Trapdoors, Gotchas</h2>

<p><a href="http://trac.osgeo.org/gdal/wiki/PythonGotchas">http://trac.osgeo.org/gdal/wiki/PythonGotchas</a></p>

<hr><h2>
<a name="giving-back-contributing-to-the-cookbook" class="anchor" href="#giving-back-contributing-to-the-cookbook"><span class="octicon octicon-link"></span></a>Giving Back: Contributing to the Cookbook</h2>

<h3>
<a name="clone" class="anchor" href="#clone"><span class="octicon octicon-link"></span></a>Clone</h3>

<h3>
<a name="revise" class="anchor" href="#revise"><span class="octicon octicon-link"></span></a>Revise</h3>

<h3>
<a name="send-pull-request" class="anchor" href="#send-pull-request"><span class="octicon octicon-link"></span></a>Send Pull Request</h3>

<hr><h3>
<a name="authors-and-contributors" class="anchor" href="#authors-and-contributors"><span class="octicon octicon-link"></span></a>Authors and Contributors</h3>

<p>Thanks to the developers at Pierce County GIS <a href="https://github.com/jericks" class="user-mention">@jericks</a>, Cort Daniels, Michael Payne. Thanks to Greg Corradini for putting this together last minute like.</p>
      </section>
      <footer>
        <p><small>Hosted on <a href="https://pages.github.com">GitHub Pages</a> using the Dinky theme</small></p>
      </footer>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
		
  </body>
</html>